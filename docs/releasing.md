# BAML Release Guide

> **⚠️ IMPORTANT NOTE**
>
> This document was initially generated by an AI assistant and should be taken with a grain of salt. While it provides a good starting point, some information might be inaccurate or outdated. We encourage contributors to manually update this document and remove this note once the content has been verified and corrected by the team.
>
> If you find any inaccuracies or have improvements to suggest, please feel free to submit a PR updating this guide.

This document outlines the process for releasing new versions of BAML, including version bumping, changelog updates, and documentation updates.

## Table of Contents

1. [Prerequisites](#prerequisites)
2. [Version Bumping](#version-bumping)
3. [Release Process](#release-process)
4. [Documentation Updates](#documentation-updates)
5. [Post-Release Tasks](#post-release-tasks)

## Prerequisites

Before starting a release, ensure you have the following tools installed:

```bash
# Install bump2version using pipx
pipx install bump2version

# Install git-cliff for changelog generation
cargo install git-cliff

# Install other required tools
npm install -g fern-api
```

## Version Bumping

BAML uses a semantic versioning system with automated version bumping tools.

### Using the Version Bump Script

The main script for bumping versions is `tools/bump-version`:

```bash
# Bump all versions (default)
./tools/bump-version

# Bump specific components
./tools/bump-version --ts      # TypeScript only
./tools/bump-version --python  # Python only
./tools/bump-version --ruby    # Ruby only
./tools/bump-version --vscode  # VSCode extension only

# Allow dirty git state
./tools/bump-version --allow-dirty
```

### Version Bump Process

1. **Code Change Detection**
   - The script automatically detects changes in code generation
   - Recommends minor or patch version based on changes
   - Allows manual override with confirmation

2. **Component Versioning**
   - Updates versions in:
     - Engine (`tools/versions/engine.cfg`)
     - Python client (`tools/versions/python.cfg`)
     - TypeScript client (`tools/versions/typescript.cfg`)
     - Ruby client (`tools/versions/ruby.cfg`)
     - VSCode extension (`tools/versions/vscode.cfg`)
     - Integration tests (`tools/versions/integ-tests.cfg`)

3. **Integration Tests**
   - Automatically runs TypeScript and Python integration tests
   - Generates test reports
   - Continues even if tests fail (with warnings)

## Release Process

### 1. Prepare Release

```bash
# Ensure you're on the main branch and up to date
git checkout main
git pull origin main

# Create a new release branch
./tools/bump-version
```

### 2. Update Changelog

The changelog is automatically generated using `git-cliff` but should be reviewed and organized:

1. **Review Generated Changes**
   - Check `CHANGELOG.md` for accuracy
   - Organize changes into categories:
     - Breaking Changes
     - Features
     - Bug Fixes
     - Documentation
     - Internal Changes

2. **Update Changelog Format**
   ```markdown
   ## [VERSION] - YYYY-MM-DD

   ### Breaking Changes
   - List breaking changes

   ### Features
   - List new features

   ### Bug Fixes
   - List bug fixes
   ```

3. **Remove UNMATCHED Section**
   - Remove any "UNMATCHED" sections
   - Ensure all changes are properly categorized

### 3. Create Release PR

The script automatically:
1. Creates a branch named `bump-version-[NEW_VERSION]`
2. Commits version bumps and changelog
3. Creates a PR with test results

### 4. Release Packages

After PR approval and merge:

1. **CLI Release**
   - Automated through GitHub Actions
   - Creates platform-specific builds
   - Updates Homebrew formula

2. **Language Clients**
   ```bash
   # Python Client
   cd engine/language_client_python
   poetry publish

   # TypeScript Client
   cd engine/language_client_typescript
   pnpm publish

   # Ruby Client
   cd engine/language_client_ruby
   bundle exec rake release
   ```

3. **VSCode Extension**
   - Published through GitHub Actions
   - Available on VSCode Marketplace

## Documentation Updates

### 1. Update Fern Documentation

```bash
# Install Fern CLI (if not already installed)
npm install -g fern-api

# Generate documentation
fern generate --docs

# Test locally
fern docs dev
```

### 2. Documentation Deployment

Documentation is automatically updated when changes are pushed to main:

1. **Automated Updates**
   - Fern documentation generation
   - API reference updates
   - Example updates

2. **Manual Review**
   - Check generated documentation
   - Verify cross-references
   - Test all code examples

## Post-Release Tasks

1. **Verify Releases**
   - Check all package registries
   - Verify documentation updates
   - Test installation from package managers

2. **Announcements**
   - Update release notes on GitHub
   - Notify community on Discord
   - Update documentation links

3. **Cleanup**
   - Archive release artifacts
   - Update version tracking
   - Clean up temporary branches

## Troubleshooting

### Common Issues

1. **Version Bump Failures**
   ```bash
   # Reset version files
   git checkout -- tools/versions/*.cfg

   # Try again with clean state
   ./tools/bump-version --allow-dirty
   ```

2. **Documentation Generation Issues**
   ```bash
   # Clear Fern cache
   rm -rf .fern

   # Regenerate docs
   fern generate --docs
   ```

3. **Integration Test Failures**
   - Check test logs in `integ-tests/`
   - Verify environment variables
   - Check for API rate limits

## Additional Resources

1. **Configuration Files**
   - `.bumpversion.cfg` files in each component
   - `fern.config.json` for documentation
   - GitHub Actions workflows

2. **Release Scripts**
   - `tools/bump-version` - Main version bump script
   - `release/*.sh` - Component-specific release scripts
   - GitHub Actions workflows in `.github/workflows/`

3. **Documentation**
   - [Design Documentation](./design.md)
   - [Coding Standards](./coding-standards.md)
   - [Troubleshooting Guide](./troubleshooting.md)