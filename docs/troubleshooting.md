# BAML Troubleshooting Guide

> **⚠️ IMPORTANT NOTE**
>
> This document was initially generated by an AI assistant and should be taken with a grain of salt. While it provides a good starting point, some information might be inaccurate or outdated. We encourage contributors to manually update this document and remove this note once the content has been verified and corrected by the team.
>
> If you find any inaccuracies or have improvements to suggest, please feel free to submit a PR updating this guide.

This guide helps you diagnose and fix common issues you might encounter while working with BAML.

## Table of Contents

1. [Installation Issues](#installation-issues)
2. [Build Problems](#build-problems)
3. [Runtime Issues](#runtime-issues)
4. [Language Client Issues](#language-client-issues)
5. [Provider Integration Issues](#provider-integration-issues)
6. [VSCode Extension Issues](#vscode-extension-issues)
7. [Common Error Messages](#common-error-messages)

## Installation Issues

### CLI Installation

1. **Permission Errors**
   ```bash
   Error: EACCES: permission denied
   ```
   Solution:
   ```bash
   # Install with sudo
   sudo npm install -g @baml/cli

   # Or fix npm permissions
   sudo chown -R $USER ~/.npm
   ```

2. **Version Conflicts**
   ```bash
   Error: Conflicting versions of @baml/cli found
   ```
   Solution:
   ```bash
   # Remove old versions
   npm uninstall -g @baml/cli
   # Install fresh
   npm install -g @baml/cli
   ```

### Language Client Installation

1. **Python Client**
   ```bash
   error: Could not find a version that satisfies the requirement baml-py
   ```
   Solution:
   ```bash
   # Ensure Python 3.8+
   python --version

   # Update pip
   pip install --upgrade pip

   # Install with specific version
   pip install "baml-py>=1.0.0"
   ```

2. **TypeScript Client**
   ```bash
   npm ERR! code ERESOLVE
   npm ERR! ERESOLVE unable to resolve dependency tree
   ```
   Solution:
   ```bash
   # Clear npm cache
   npm cache clean --force

   # Install with legacy peer deps
   npm install --legacy-peer-deps
   ```

3. **Ruby Client**
   ```bash
   ERROR: Failed to build gem native extension
   ```
   Solution:
   ```bash
   # Install development tools
   brew install ruby-dev  # macOS
   apt-get install ruby-dev  # Ubuntu

   # Install bundler
   gem install bundler

   # Install dependencies
   bundle install
   ```

## Build Problems

### Rust Build Issues

1. **Cargo Build Failures**
   ```bash
   error[E0308]: mismatched types
   ```
   Solution:
   ```bash
   # Clean build artifacts
   cargo clean

   # Update dependencies
   cargo update

   # Build with verbose output
   cargo build -v
   ```

2. **Missing Dependencies**
   ```bash
   error: failed to run custom build command for `openssl-sys`
   ```
   Solution:
   ```bash
   # macOS
   brew install openssl pkg-config

   # Ubuntu
   apt-get install libssl-dev pkg-config
   ```

### Native Client Build Issues

1. **Python Extensions**
   ```bash
   error: can't find Python.h
   ```
   Solution:
   ```bash
   # macOS
   brew install python3-dev

   # Ubuntu
   apt-get install python3-dev
   ```

2. **Node Native Modules**
   ```bash
   gyp ERR! build error
   ```
   Solution:
   ```bash
   # Install build tools
   npm install -g node-gyp

   # Rebuild
   npm rebuild
   ```

## Runtime Issues

### Provider Connection

1. **API Key Issues**
   ```
   error: Invalid API key provided
   ```
   Solution:
   ```bash
   # Check environment variables
   echo $OPENAI_API_KEY

   # Set API key
   export OPENAI_API_KEY="your-key-here"
   ```

2. **Rate Limits**
   ```
   error: Too many requests
   ```
   Solution:
   ```bash
   # Add rate limiting
   export BAML_RATE_LIMIT=10

   # Enable retries
   export BAML_MAX_RETRIES=3
   ```

### Memory Issues

1. **Out of Memory**
   ```
   error: JavaScript heap out of memory
   ```
   Solution:
   ```bash
   # Increase Node.js memory
   export NODE_OPTIONS="--max-old-space-size=8192"

   # Use streaming for large responses
   export BAML_USE_STREAMING=true
   ```

2. **Memory Leaks**
   ```
   Warning: Possible memory leak detected
   ```
   Solution:
   ```bash
   # Enable garbage collection logs
   export NODE_OPTIONS="--trace-gc"

   # Monitor memory usage
   export BAML_MEMORY_MONITOR=true
   ```

## Language Client Issues

### Python Client

1. **Import Errors**
   ```python
   ImportError: No module named 'baml'
   ```
   Solution:
   ```bash
   # Check installation
   pip list | grep baml

   # Reinstall
   pip install --force-reinstall baml-py
   ```

2. **Type Errors**
   ```python
   TypeError: Incompatible type
   ```
   Solution:
   ```python
   # Enable type checking
   from typing import TYPE_CHECKING
   if TYPE_CHECKING:
       from baml.types import UserProfile

   # Use runtime type checking
   import typeguard
   ```

### TypeScript Client

1. **Type Definition Issues**
   ```typescript
   error TS2307: Cannot find module '@baml/client'
   ```
   Solution:
   ```bash
   # Install types
   npm install --save-dev @types/baml__client

   # Update tsconfig.json
   {
     "compilerOptions": {
       "typeRoots": ["./node_modules/@types"]
     }
   }
   ```

2. **Runtime Errors**
   ```typescript
   Error: Cannot read property 'x' of undefined
   ```
   Solution:
   ```typescript
   // Add null checks
   if (response?.data?.x) {
     // Use data
   }

   // Enable strict mode
   {
     "compilerOptions": {
       "strict": true
     }
   }
   ```

## Provider Integration Issues

### OpenAI

1. **Authentication**
   ```
   error: Authentication failed for OpenAI API
   ```
   Solution:
   ```bash
   # Verify API key format
   echo $OPENAI_API_KEY | grep "sk-"

   # Check organization
   export OPENAI_ORG_ID="org-..."
   ```

2. **Model Access**
   ```
   error: You don't have access to gpt-4
   ```
   Solution:
   ```bash
   # Use available model
   export OPENAI_MODEL="gpt-3.5-turbo"

   # Request model access
   # Visit: platform.openai.com/account
   ```

### Anthropic

1. **API Errors**
   ```
   error: Invalid API version
   ```
   Solution:
   ```bash
   # Set API version
   export ANTHROPIC_API_VERSION="2023-06-01"

   # Update client version
   npm install @anthropic-ai/sdk@latest
   ```

## VSCode Extension Issues

1. **Extension Not Loading**
   ```
   Extension activation failed
   ```
   Solution:
   ```bash
   # Clear extension cache
   rm -rf ~/.vscode/extensions/boundary.baml-*

   # Reinstall extension
   code --install-extension boundary.baml
   ```

2. **Language Server Issues**
   ```
   Language server not started
   ```
   Solution:
   ```bash
   # Check logs
   View > Output > BAML Language Server

   # Restart language server
   Cmd/Ctrl + Shift + P > BAML: Restart Language Server
   ```

## Common Error Messages

### Compiler Errors

1. **Type Mismatch**
   ```
   error: Type mismatch in function 'ExtractUserInfo'
   ```
   Solution:
   - Check type definitions
   - Verify function signatures
   - Use correct type imports

2. **Syntax Errors**
   ```
   error: Unexpected token in BAML file
   ```
   Solution:
   - Validate BAML syntax
   - Check for missing semicolons
   - Verify brackets and braces

### Runtime Errors

1. **Provider Timeout**
   ```
   error: Request timed out after 30s
   ```
   Solution:
   ```bash
   # Increase timeout
   export BAML_TIMEOUT=60

   # Enable retries
   export BAML_RETRY_COUNT=3
   ```

2. **Memory Errors**
   ```
   error: Process out of memory
   ```
   Solution:
   ```bash
   # Increase memory limit
   export NODE_OPTIONS="--max-old-space-size=4096"

   # Enable streaming
   export BAML_STREAM=true
   ```

## Getting Help

1. **Community Support**
   - Join [Discord](https://discord.gg/BTNBeXGuaS)
   - Check [GitHub Issues](https://github.com/boundaryml/baml/issues)
   - Read [Documentation](https://docs.boundaryml.com)

2. **Debugging Tools**
   ```bash
   # Enable debug logging
   export BAML_LOG=debug

   # Show verbose output
   export BAML_VERBOSE=true
   ```

3. **Reporting Issues**
   - Include BAML version
   - Provide minimal reproduction
   - Share error logs
   - Describe environment