---
title: useBamlAction
description: Generic hook for executing BAML server actions
---

The `useBamlAction` hook provides a generic interface for executing any BAML server action with streaming support. For auto-generated hooks, see [Generated Hooks](./generated-hooks).

<Warning>
  Different props and results are available based on streaming mode. For streaming details, see [Stream Response](./stream-response).
</Warning>

<CodeBlocks>
```typescript title="app/actions/story.ts"
'use server'

import { b } from "@/baml_client";

export async function writeMeAStoryAction(prompt: string) {
  // Add your own logic (auth, validation, etc.)
  const auth = await auth();
  if (!auth) throw new Error("Unauthorized");

  // Choose streaming or non-streaming mode:
  return b.stream.WriteMeAStory(prompt).toStreamable();
}
```

```typescript title="app/components/story.tsx"
'use client'

import { useBamlAction } from "@/baml_client/react/hooks";
import { writeMeAStoryAction } from "../actions/story";

export function StoryComponent() {
  const { data, partialData, isLoading, mutate } = useBamlAction(writeMeAStoryAction, {
    stream: true,
    onPartial: (partial) => console.log('Progress:', partial)
  });

  return (
    <div>
      <button onClick={() => mutate("Dragons")}>
        Generate Story
      </button>
      {isLoading ? partialData?.content : data?.content}
    </div>
  );
}
```
</CodeBlocks>

## Type Parameters

<ParamField
  path="TActionKey"
  type="generic"
>
  The key of the BAML action being called. Used to infer the correct types for responses.
</ParamField>

## Parameters

<ParamField
  path="action"
  type="ServerAction"
>
  A Next.js server action that returns either a Promise or a ReadableStream. See [Server Action](./server-action) for more details.
</ParamField>

<ParamField
  path="props"
  type="HookProps<TActionKey>"
>
  Configuration options for the hook. See [Hook Props](./hook-props) for details.
</ParamField>

## Return Value Properties

<ParamField
  path="data"
  type="FinalReturnType<TActionKey> | undefined"
>
  The final response data when the request completes. See [Return Types](./return-types) for more details.
</ParamField>

<ParamField
  path="partialData"
  type="PartialReturnType<TActionKey> | undefined"
>
  The latest partial response during streaming. Only available in streaming mode. See [Stream Response](./stream-response) for more details.
</ParamField>

<ParamField
  path="error"
  type="Error | BamlValidationError | BamlClientFinishReasonError | undefined"
>
  Error information if the request fails. See [Error Types](./error-types) for details.
</ParamField>

<ParamField
  path="isError"
  type="boolean"
>
  True if the request failed.
</ParamField>

<ParamField
  path="isPending"
  type="boolean"
>
  True while the request is in progress.
</ParamField>

<ParamField
  path="isSuccess"
  type="boolean"
>
  True if the request completed successfully.
</ParamField>

<ParamField
  path="status"
  type="'idle' | 'pending' | 'success' | 'error'"
>
  The current state of the request.
</ParamField>

<ParamField
  path="mutate"
  type="(...args: Parameters<Action>) => Promise<ReturnType<Action>>"
>
  Function to execute the server action with type-safe arguments.
</ParamField>

<ParamField
  path="result"
  type="HookResult<TActionKey>"
>
  The hook result object. See [Hook Result](./hook-result) for details.
</ParamField>

## Usage Examples

### Custom Server Action with Auth

<CodeBlocks>
```typescript title="app/actions/protected-story.ts"
'use server'

import { b } from "@/baml_client";
import { auth } from "@/auth";

// For more details on server actions, see Server Action documentation
// See: ./server-action
export async function protectedStoryAction(prompt: string) {
  const session = await auth();
  if (!session) throw new Error("Unauthorized");

  // Rate limiting
  const rateLimitOk = await checkRateLimit(session.user.id);
  if (!rateLimitOk) throw new Error("Rate limit exceeded");

  // Input validation
  if (prompt.length < 10) throw new Error("Prompt too short");

  // Streaming mode
  return b.stream.WriteMeAStory(prompt).toStreamable();
}
```

```typescript title="app/components/protected-story.tsx"
'use client'

import { useBamlAction } from "@/baml_client/react/hooks";
import { protectedStoryAction } from "../actions/protected-story";

export function ProtectedStory() {
  const {
    data,
    partialData,
    isLoading,
    error,
    mutate
  } = useBamlAction(protectedStoryAction, {
    stream: true,
    onError: (error) => {
      if (error.message === "Unauthorized") {
        // Redirect to login
        router.push("/login");
      }
    }
  });

  return (
    <div>
      <button
        onClick={() => mutate("Tell me an epic story about dragons")}
        disabled={isLoading}
      >
        {isLoading ? "Generating..." : "Generate Story"}
      </button>

      <div className="story">
        {isLoading ? (
          <>
            <div className="loading">Writing story...</div>
            <p>{partialData?.content}</p>
          </>
        ) : data ? (
          <>
            <h3>{data.title}</h3>
            <p>{data.content}</p>
          </>
        ) : null}
      </div>

      {error && <div className="error">{error.message}</div>}
    </div>
  );
}
```
</CodeBlocks>

### Error Handling

<CodeBlocks>
```typescript title="app/components/error-boundaries.tsx"
'use client'

import { useBamlAction } from "@/baml_client/react/hooks";
import { BamlValidationError, BamlClientFinishReasonError } from "@boundaryml/baml/errors";

// For complete error handling details, see Error Types documentation
// See: ./error-types
export function StoryWithErrorBoundary() {
  const { mutate, error, isLoading } = useBamlAction(protectedStoryAction, {
    onError: (error) => {
      if (error instanceof BamlValidationError) {
        // Handle validation errors
        console.error('Validation error:', error.message);
        console.error('Raw LLM output:', error.raw_output);
      } else if (error instanceof BamlClientFinishReasonError) {
        // Handle early termination
        console.error('LLM terminated early:', error.finish_reason);
      } else if (error.message === "Unauthorized") {
        // Handle auth errors
        router.push("/login");
      } else if (error.message === "Rate limit exceeded") {
        // Handle rate limiting
        toast.error("Please wait before generating another story");
      } else {
        // Handle other errors
        console.error('Other error:', error);
      }
    }
  });

  return (
    <ErrorBoundary fallback={<ErrorFallback />}>
      <div>
        <button
          onClick={() => mutate("Dragons")}
          disabled={isLoading}
        >
          Generate Story
        </button>

        {error && (
          <div className="error">
            {error instanceof BamlValidationError ? (
              <span>Failed to understand AI response</span>
            ) : error instanceof BamlClientFinishReasonError ? (
              <span>AI response was cut off</span>
            ) : (
              <span>{error.message}</span>
            )}
          </div>
        )}
      </div>
    </ErrorBoundary>
  );
}
```
</CodeBlocks>

<Note>
For direct BAML function calls without server actions, use the [Generated Hooks](./generated-hooks) instead.
</Note>
