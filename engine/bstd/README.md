# BAML Standard Library (bstd)

> **⚠️ IMPORTANT NOTE**
>
> This document was initially generated by an AI assistant and should be taken with a grain of salt. While it provides a good starting point, some information might be inaccurate or outdated. We encourage contributors to manually update this document and remove this note once the content has been verified and corrected by the team.
>
> If you find any inaccuracies or have improvements to suggest, please feel free to submit a PR updating this guide.

Core utilities and standard functions for the BAML language and runtime.

## Components

```
bstd/
├── src/
│   ├── lib.rs         # Library entry point
│   ├── functions/     # Standard functions
│   │   ├── text.rs    # Text processing
│   │   └── json.rs    # JSON handling
│   ├── types/        # Common types
│   └── utils/        # Shared utilities
└── tests/           # Standard library tests
```

## Features

- Common text processing functions
- JSON manipulation utilities
- Standard type definitions
- Shared runtime utilities
- Testing helpers

## Standard Functions

### Text Processing

```rust
pub mod text {
    /// Split text into chunks with overlap
    pub fn chunk_text(text: &str, chunk_size: usize, overlap: usize) -> Vec<String> {
        // Implementation
    }

    /// Clean and normalize text
    pub fn normalize_text(text: &str) -> String {
        // Implementation
    }
}
```

### JSON Handling

```rust
pub mod json {
    /// Merge multiple JSON objects
    pub fn merge_json(objects: &[Value]) -> Result<Value> {
        // Implementation
    }

    /// Extract paths from JSON
    pub fn json_paths(value: &Value) -> Vec<String> {
        // Implementation
    }
}
```

## Common Types

```rust
pub mod types {
    /// Common response type
    #[derive(Debug, Clone)]
    pub struct Response<T> {
        pub data: T,
        pub metadata: Metadata,
    }

    /// Standard error types
    #[derive(Debug, Error)]
    pub enum StdError {
        #[error("Invalid input: {0}")]
        InvalidInput(String),
        #[error("Processing error: {0}")]
        Processing(String),
    }
}
```

## Development

### Building

```bash
# Build library
cargo build

# Build with all features
cargo build --all-features
```

### Testing

```bash
# Run all tests
cargo test

# Test specific module
cargo test text::
```

## Usage in BAML Projects

### In BAML Files

```baml
import bstd.text.chunk_text

function ProcessText(text: string) -> string[] {
    use chunk_text(chunk_size: 1000, overlap: 100)
}
```

### In Rust Code

```rust
use bstd::{text, json, types};

fn process_data(input: &str) -> Result<Response<String>> {
    let chunks = text::chunk_text(input, 1000, 100);
    // Process chunks
}
```

## Adding New Features

### 1. New Function

```rust
// src/functions/new_module.rs
pub fn new_function(input: &str) -> Result<String> {
    // Implementation
}

#[cfg(test)]
mod tests {
    #[test]
    fn test_new_function() {
        // Test implementation
    }
}
```

### 2. New Type

```rust
// src/types/mod.rs
#[derive(Debug, Clone)]
pub struct NewType {
    pub field: String,
}

impl NewType {
    pub fn new(field: String) -> Self {
        Self { field }
    }
}
```

## Testing

### Unit Tests

```rust
#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_chunk_text() {
        let text = "Hello World";
        let chunks = chunk_text(text, 5, 2);
        assert_eq!(chunks.len(), 3);
    }
}
```

### Integration Tests

```rust
// tests/integration_test.rs
use bstd::{text, json};

#[test]
fn test_text_processing() {
    let input = "Test input";
    let result = text::process_pipeline(input);
    assert!(result.is_ok());
}
```

## Debugging

1. **Library Issues**:
```bash
# Enable debug logs
RUST_LOG=debug cargo test

# Check specific module
RUST_LOG=bstd::text=trace cargo test
```

2. **Common Problems**:
- Memory allocation in text processing
- JSON parsing errors
- Type conversion issues