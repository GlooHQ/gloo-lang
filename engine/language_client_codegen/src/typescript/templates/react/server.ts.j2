'use server'

import { b } from '../index';
import { Check, Checked, RecursivePartialNull } from "../types"
import { Image, Audio } from "@boundaryml/baml"
import {
  {%- for t in types %}{{ t }}{% if !loop.last %}, {% endif %}{% endfor -%}
} from "../types"

{%- for func in funcs %}
/**
 * Server action for the {{ func.name }} BAML function.
 *
 * Input Types:
 * {%- for (name, optional, type) in func.args %}
 * - {{ name }}{% if optional %} (optional){% endif %}: {{ type }}
 * {%- endfor %}
 *
 * Return Type:
 * - Non-streaming: {{ func.return_type }}
 * - Streaming: ReadableStream
 */
 export async function {{ func.name }}Action<Options extends { stream: true }>(
  {%- for (name, optional, type) in func.args %}
  {{ name }}{% if optional %}?{% endif %}: {{ type }},
  {%- endfor %}
  options?: Options
): Promise<ReadableStream<Uint8Array>>;

export async function {{ func.name }}Action<Options extends { stream?: false }>(
  {%- for (name, optional, type) in func.args %}
  {{ name }}{% if optional %}?{% endif %}: {{ type }},
  {%- endfor %}
  options?: Options
): Promise<{{ func.return_type }}>;

export async function {{ func.name }}Action<Options extends { stream?: boolean }>(
  {%- for (name, optional, type) in func.args %}
  {{ name }}{% if optional %}?{% endif %}: {{ type }},
  {%- endfor %}
  options?: Options
): Promise<Options['stream'] extends true ? ReadableStream<Uint8Array> : {{ func.return_type }}> {
  if (options?.stream) {
    const stream = b.stream.{{ func.name }}(
      {%- for (name, _, _) in func.args %}
      {{ name }},
      {%- endfor %}
    );
    return stream.toStreamable();
  }
  return b.{{ func.name }}(
    {%- for (name, _, _) in func.args %}
    {{ name }},
    {%- endfor %}
  );
};
{% endfor -%}
